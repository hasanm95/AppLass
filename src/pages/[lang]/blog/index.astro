---
import Layout from '../../../layouts/Layout.astro';
import { Navbar, Footer } from "@/components/common";
import { BlogHero } from "@/components/blog/BlogHero";
import { BlogCard } from "@/components/blog/BlogCard";
import { getBlogPosts, getBlogCategories } from "@/lib/blog";
import { getDictionary } from "@/i18n/get-dictionary";
import { i18nConfig } from "@/i18n/config";

export async function getStaticPaths() {
  return i18nConfig.locales.map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params;
const dict = await getDictionary(lang as any);

const meta = dict.metadata?.blog || {};

const posts = getBlogPosts();
const categories = getBlogCategories();

const featuredPost = posts.find((post) => post.featured) || posts[0];
const otherPosts = posts.filter(
  (post) => post.slug !== (featuredPost?.slug || "")
);
---

<Layout 
  title={meta.title || "The Logic Lab | AppLass Blog"}
  description={meta.description || "Deep dives into software engineering, mathematics, and digital productivity."}
  keywords={meta.keywords}
  ogTitle={meta.ogTitle}
  ogDescription={meta.ogDescription}
  ogImage={meta.ogImage}
  ogUrl={meta.ogUrl}
  lang={lang}
>
  <Navbar client:load translations={dict.nav} />
  <div class="flex-1 bg-white pt-20">
    <BlogHero client:load />
    <section class="section border-y border-slate-100/50 bg-[#FAFBFD] py-24">
      <div class="section-container">
        <div class="mb-16 flex flex-wrap gap-4">
          {categories.map((category) => (
            <button
              class="rounded-full border border-slate-200 bg-white px-6 py-2 text-sm font-bold text-slate-500 transition-all hover:border-blue-600 hover:text-blue-600"
            >
              {category}
            </button>
          ))}
        </div>

        {featuredPost && (
          <div class="mb-20">
            <BlogCard post={featuredPost} isHero={true} />
          </div>
        )}

        <div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
          {otherPosts.map((post) => (
            <BlogCard post={post} />
          ))}
        </div>

        {posts.length === 0 && (
          <div class="py-20 text-center">
            <p class="font-bold text-slate-400">
              No articles published yet. Check back soon.
            </p>
          </div>
        )}
      </div>
    </section>
  </div>
  <Footer translations={dict.footer} />
</Layout>
